# Environment Variables Configuration

This file provides templates for environment variables required by the CMS Analytics Dashboard.

## Quick Start

1. **Copy the example file:**
   ```bash
   cp .env.example .env
   ```

2. **Update the values** in `.env` with your actual configuration

## Environment Variables

### Server Configuration
- `NODE_ENV`: Application environment (`development`, `production`, or `test`)
- `PORT`: Port number for the Express server (default: 5001)

### Database Configuration
PostgreSQL database connection settings:
- `DB_HOST`: Database host (default: localhost)
- `DB_PORT`: Database port (default: 5432)
- `DB_NAME`: Database name (default: cms_analytics)
- `DB_USER`: Database username (default: postgres)
- `DB_PASSWORD`: Database password

### JWT Configuration
- `JWT_SECRET`: Secret key for JWT token signing (minimum 32 characters)
  - **⚠️ IMPORTANT:** Change this to a strong, random string in production
  - Generate with: `node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"`

### Redis Configuration (Optional)
Used for session management and caching:
- `REDIS_HOST`: Redis server host (default: localhost)
- `REDIS_PORT`: Redis server port (default: 6379)
- `REDIS_PASSWORD`: Redis password (if required)

### Client Configuration
- `CLIENT_URL`: Frontend URL for CORS configuration (default: http://localhost:3000)

### WebSocket Configuration
- `WS_PORT`: WebSocket server port (typically same as PORT)

## Database Setup

### 1. Install PostgreSQL
Download and install PostgreSQL from: https://www.postgresql.org/download/

### 2. Create Database
```bash
# Connect to PostgreSQL
psql -U postgres

# Create database
CREATE DATABASE cms_analytics;

# Exit
\q
```

### 3. Run Migrations
The application will automatically run migrations on startup. The migrations create the following tables:
- `tenants` - Multi-tenant organizations
- `users` - User accounts
- `content` - CMS content items
- `analytics` - Analytics data
- `sessions` - User session management

### 4. Seed Data (Development Only)
In development mode, sample data is automatically seeded with:
- Demo tenant
- Sample users (admin@demo.com, editor@demo.com, viewer@demo.com)
- Sample content
- Sample analytics data

**Default password for all demo users:** `password123`

## Security Best Practices

### Production Environment
1. **Change JWT_SECRET**: Use a strong, random 32+ character string
2. **Strong DB Password**: Use a complex database password
3. **Secure Environment File**: Never commit `.env` file to version control
4. **HTTPS Only**: Always use HTTPS in production
5. **Update Defaults**: Change all default passwords immediately

### Generate Secure Secrets
```bash
# Generate JWT secret
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Generate database password
node -e "console.log(require('crypto').randomBytes(24).toString('base64'))"
```

## Troubleshooting

### Database Connection Issues
```
Error: connect ECONNREFUSED 127.0.0.1:5432
```
**Solution:** Ensure PostgreSQL is running:
- Windows: Check Services for "postgresql" service
- Mac: `brew services start postgresql`
- Linux: `sudo systemctl start postgresql`

### JWT Token Errors
```
Error: secretOrPrivateKey must have a value
```
**Solution:** Ensure JWT_SECRET is set in your `.env` file

### Port Already in Use
```
Error: listen EADDRINUSE: address already in use :::5001
```
**Solution:** Change PORT in `.env` or stop the process using that port

## Additional Resources

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [JWT.io](https://jwt.io/)
- [Express.js Documentation](https://expressjs.com/)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
